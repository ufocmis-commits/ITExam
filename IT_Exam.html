<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¨‹å¼æ¸¬é©—ï¼šJS / .NET / SQL</title>
    
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-okaidia.min.css" rel="stylesheet" />

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/dracula.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/hint/show-hint.min.css">

    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2c3e50;
            --bg-light: #f4f7f6;
            --text-dark: #333;
            --card-shadow: 0 4px 8px rgba(0,0,0,0.1);
            --table-border: #ddd;
            --table-header: #f2f2f2;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-light);
            color: var(--text-dark);
            line-height: 1.6;
            padding: 20px;
            margin: 0;
        }

        .container {
            max-width: 1000px; /* åŠ å¯¬ä¸€é»ä»¥å®¹ç´è¡¨æ ¼ */
            margin: 0 auto;
            background-color: #fff;
            padding: 30px;
            border-radius: 12px;
            box-shadow: var(--card-shadow);
            min-height: 400px; 
        }

        h1 {
            text-align: center;
            color: var(--secondary-color);
            margin-bottom: 30px;
        }

        .user-info {
            margin-bottom: 30px;
            padding: 20px;
            background-color: #eef2f5;
            border-radius: 8px;
        }

        .user-info label { font-weight: bold; margin-right: 10px; }
        .user-info input { padding: 8px 12px; border: 1px solid #ccc; border-radius: 4px; width: 250px; font-size: 16px; }

        .question-card {
            background-color: #fff;
            border: 1px solid #e1e4e8;
            border-radius: 8px;
            padding: 25px;
            margin-bottom: 25px;
            transition: transform 0.2s;
        }

        .question-card:hover { box-shadow: var(--card-shadow); }

        .question-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--secondary-color);
            margin-top: 0;
            margin-bottom: 15px;
        }
        
        .badge {
            background-color: #e74c3c;
            color: white;
            font-size: 0.8rem;
            padding: 2px 8px;
            border-radius: 4px;
            margin-left: 10px;
            vertical-align: middle;
        }
        
        .question-text { margin-bottom: 15px; }

        /* PrismJS å¾®èª¿ */
        pre[class*="language-"] {
            border-radius: 6px;
            margin-bottom: 10px;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.3);
        }

        .options label {
            display: block;
            padding: 15px;
            margin-bottom: 15px;
            background-color: #f8f9fa;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.2s;
            border: 2px solid transparent;
            position: relative;
        }
        
        .options label:hover { background-color: #e9ecef; }
        
        .options label pre {
            margin-top: 10px;
            margin-bottom: 0;
            pointer-events: none; 
        }

        .options input {
            transform: scale(1.2);
            margin-right: 10px;
        }
        
        .options input:checked + span { font-weight: bold; color: var(--primary-color); }
        .options input:checked + span::before { content: "âœ” "; }

        /* --- æ–°å¢ï¼šè³‡æ–™è¡¨è¦–è¦ºåŒ–æ¨£å¼ --- */
        .db-tables-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
            font-size: 0.85rem;
        }

        .table-wrapper {
            border: 1px solid var(--table-border);
            border-radius: 6px;
            overflow: hidden;
        }

        .table-caption {
            background-color: #34495e;
            color: #fff;
            padding: 5px 10px;
            font-weight: bold;
            font-size: 0.9rem;
            border-bottom: 2px solid #2c3e50;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table th, .data-table td {
            border: 1px solid #eee;
            padding: 4px 8px;
            text-align: left;
        }

        .data-table th {
            background-color: #f8f9fa;
            font-weight: 600;
            color: #555;
        }

        .data-table tr:nth-child(even) {
            background-color: #fafafa;
        }
        
        /* é æœŸçµæœæ¨£å¼ */
        .expected-result-box {
            background-color: #e8f6f3;
            border: 1px solid #a2d9ce;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 20px;
        }
        .expected-result-box h4 {
            margin-top: 0;
            color: #16a085;
            margin-bottom: 10px;
        }
        /* -------------------------- */

        /* CodeMirror ç·¨è¼¯å™¨å®¢è£½åŒ– */
        .CodeMirror {
            height: 350px;
            border-radius: 6px;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 15px;
            border: 1px solid #ddd;
        }
        .editor-hint {
            display: block;
            margin-bottom: 5px;
            font-size: 0.9rem;
            color: #666;
            background: #eee;
            padding: 5px 10px;
            border-radius: 4px;
        }

        .submit-btn {
            display: block;
            width: 100%;
            padding: 15px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s;
            margin-top: 20px;
        }

        .submit-btn:hover { background-color: #2980b9; }
        .submit-btn:disabled { background-color: #95a5a6; cursor: not-allowed; }

        #loading-message {
            text-align: center;
            display: none;
            margin-top: 50px;
            font-size: 1.2rem;
            color: var(--primary-color);
        }

        #result-view {
            display: none;
            text-align: center;
            padding: 40px;
        }
        #result-view h2 {
            color: #27ae60;
            font-size: 2rem;
            margin-bottom: 20px;
        }
        #result-view p {
            font-size: 1.2rem;
            color: #555;
        }
        .success-icon {
            font-size: 4rem;
            color: #27ae60;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>ç¨‹å¼æ¸¬é©—ï¼šJS / .NET / SQL</h1>
    
    <div id="quiz-content">
        <div class="user-info">
            <label for="username">è€ƒç”Ÿå§“åï¼š</label>
            <input type="text" id="username" placeholder="è«‹è¼¸å…¥æ‚¨çš„çœŸå¯¦å§“å" required>
            <p style="font-size: 0.9rem; color: #666; margin-top: 10px;">æ¸¬é©—èªªæ˜ï¼šå…± 5 é¡Œï¼Œå‰ 4 é¡Œç‚ºé¸æ“‡(å«è¤‡é¸)ï¼Œç¬¬ 5 é¡Œç‚º SQL æ‰‹å¯«é¡Œã€‚</p>
        </div>

        <form id="quiz-form">
            <div class="question-card" data-id="q1">
                <h3 class="question-title">1. JS ç¶œåˆåŸ·è¡Œé †åºåˆ†æ</h3>
                <div class="question-text">è«‹åˆ†æä»¥ä¸‹ç¨‹å¼ç¢¼çš„åŸ·è¡Œé †åºã€‚å‡è¨­ç¶²è·¯è«‹æ±‚ `fetch` çš„è€—æ™‚å¤§æ–¼ 4msï¼Œæ­£ç¢ºçš„ Console è¼¸å‡ºé †åºç‚ºä½•ï¼Ÿ</div>
                <pre><code class="language-javascript">console.log('A');

setTimeout(() => console.log('B'), 0);

// æ¨¡æ“¬ç¶²è·¯è«‹æ±‚
fetch('https://api.example.com').then(() => console.log('C'));

Promise.resolve().then(() => console.log('D'));

console.log('E');</code></pre>
                <div class="options">
                    <label><input type="radio" name="q1" value="A"> <span>A -> E -> D -> C -> B</span></label>
                    <label><input type="radio" name="q1" value="B"> <span>A -> E -> D -> B -> C</span></label>
                    <label><input type="radio" name="q1" value="C"> <span>A -> B -> C -> D -> E</span></label>
                    <label><input type="radio" name="q1" value="D"> <span>A -> D -> E -> B -> C</span></label>
                </div>
            </div>

            <div class="question-card" data-id="q2">
                <h3 class="question-title">2. C# å‘¼å« API çš„æ–¹å¼ <span class="badge">è¤‡é¸é¡Œ</span></h3>
                <div class="question-text">ä¸‹åˆ—å“ªäº›æ˜¯åœ¨ C# (.NET) ç’°å¢ƒä¸­ï¼Œå‘¼å«å¤–éƒ¨ HTTP API çš„æ­£ç¢ºæˆ–å¸¸è¦‹æ–¹å¼ï¼Ÿï¼ˆè«‹é¸æ“‡æ‰€æœ‰æ­£ç¢ºç­”æ¡ˆï¼‰</div>
                <div class="options">
                    <label><input type="checkbox" name="q2" value="A"> <span>ä½¿ç”¨ <code>System.Net.Http.HttpClient</code> é¡åˆ¥</span></label>
                    <label><input type="checkbox" name="q2" value="B"> <span>ä½¿ç”¨ <code>System.Net.WebClient</code></span></label>
                    <label><input type="checkbox" name="q2" value="C"> <span>ä½¿ç”¨ <code>RestSharp</code></span></label>
                    <label><input type="checkbox" name="q2" value="D"> <span>ä½¿ç”¨ <code>IHttpClientFactory</code></span></label>
                    <label><input type="checkbox" name="q2" value="E"> <span>ä½¿ç”¨ <code>XMLHttpRequest</code> ç‰©ä»¶</span></label>
                </div>
            </div>

            <div class="question-card" data-id="q3">
                <h3 class="question-title">3. SQL ç”¢ç”Ÿé€£çºŒæ—¥æœŸè³‡æ–™ <span class="badge">è¤‡é¸é¡Œ</span></h3>
                <div class="question-text">åœ¨ SQL Server (T-SQL) ä¸­ï¼Œè‹¥ä¸å»ºç«‹å¯¦é«”æ—¥æ›†è¡¨ï¼Œä¸‹åˆ—å“ªäº› SQL èªæ³•**å¯ä»¥æ­£ç¢ºåŸ·è¡Œä¸¦ç”¢ç”Ÿ**é€£çºŒæ—¥æœŸåˆ—è¡¨ï¼Ÿ</div>
                <div class="options">
                    <label>
                        <input type="checkbox" name="q3" value="A"> 
                        <span>é¸é … A</span>
                        <pre><code class="language-sql">WITH DateCTE AS (
    SELECT CAST('2024-01-01' AS DATE) AS Dt
    UNION ALL
    SELECT DATEADD(d, 1, Dt) FROM DateCTE 
    WHERE Dt < '2024-01-05'
) 
SELECT * FROM DateCTE</code></pre>
                    </label>
                    
                    <label>
                        <input type="checkbox" name="q3" value="B"> 
                        <span>é¸é … B</span>
                        <pre><code class="language-sql">SELECT * FROM SEQUENCE('2024-01-01', '2024-01-05', '1 DAY')</code></pre>
                    </label>
                    
                    <label>
                        <input type="checkbox" name="q3" value="C"> 
                        <span>é¸é … C</span>
                        <pre><code class="language-sql">SELECT DATEADD(day, number, '2024-01-01')
FROM master..spt_values
WHERE type = 'P' AND number <= 4</code></pre>
                    </label>
                    
                    <label>
                        <input type="checkbox" name="q3" value="D"> 
                        <span>é¸é … D</span>
                        <pre><code class="language-sql">SELECT * FROM RANGE('2024-01-01', '2024-01-05')</code></pre>
                    </label>

                    <label>
                        <input type="checkbox" name="q3" value="E"> 
                        <span>é¸é … E</span>
                        <pre><code class="language-sql">FOR i IN 0..4 LOOP
    SELECT DATEADD(day, i, '2024-01-01')
END LOOP</code></pre>
                    </label>
                </div>
            </div>

            <div class="question-card" data-id="q4">
                <h3 class="question-title">4. C# å‚³çµ± ADO.NET æ¶æ§‹ <span class="badge">è¤‡é¸é¡Œ</span></h3>
                <div class="question-text">é—œæ–¼ SqlConnectionã€SqlCommand èˆ‡è³‡æ–™è®€å–æ©Ÿåˆ¶çš„æ•˜è¿°ï¼Œä¸‹åˆ—å“ªäº›æ˜¯æ­£ç¢ºçš„ï¼Ÿï¼ˆè«‹é¸æ“‡æ‰€æœ‰æ­£ç¢ºç­”æ¡ˆï¼‰</div>
                <div class="options">
                    <label>
                        <input type="checkbox" name="q4" value="A"> 
                        <span>ExecuteScalar() æ–¹æ³•æ˜¯ç”¨ä¾†åŸ·è¡Œ SQL ä¸¦å›å‚³ã€Œç¬¬ä¸€åˆ—ç¬¬ä¸€æ¬„ã€çš„è³‡æ–™ï¼Œé©åˆç”¨æ–¼æŸ¥è©¢ Count æˆ– ID</span>
                    </label>

                    <label>
                        <input type="checkbox" name="q4" value="B"> 
                        <span>é è¨­æƒ…æ³ä¸‹ï¼ŒADO.NET çš„ Connection Pooling (é€£ç·šæ± ) æ˜¯å•Ÿç”¨çš„ï¼Œé€™èƒ½å¤§å¹…æå‡é‡è¤‡é–‹å•Ÿé€£ç·šçš„æ•ˆèƒ½</span>
                    </label>

                    <label>
                        <input type="checkbox" name="q4" value="C"> 
                        <span>DataSet èˆ‡ DataTable å±¬æ–¼ã€Œé›¢ç·šå¼ (Disconnected)ã€æ¶æ§‹ï¼Œè³‡æ–™è¼‰å…¥è¨˜æ†¶é«”å¾Œå³å¯æ–·é–‹è³‡æ–™åº«é€£ç·š</span>
                    </label>

                    <label>
                        <input type="checkbox" name="q4" value="D"> 
                        <span>SqlDataReader æ˜¯å±¬æ–¼ã€Œé€£ç·šå¼ (Connected)ã€æ¶æ§‹ï¼Œè®€å–è³‡æ–™æœŸé–“ Connection å¿…é ˆä¿æŒ Open ç‹€æ…‹</span>
                    </label>

                    <label>
                        <input type="checkbox" name="q4" value="E"> 
                        <span>ä½¿ç”¨ using (SqlConnection conn = ...) èªæ³•å€å¡Šï¼Œç·¨è­¯å™¨æœƒè‡ªå‹•ç”¢ç”Ÿ try-finally ä¸¦åœ¨çµæŸæ™‚å‘¼å« Dispose() é—œé–‰é€£ç·š</span>
                    </label>
                </div>
            </div>

            <div class="question-card" data-id="q5">
                <h3 class="question-title">5. SQL èªæ³•æ’°å¯«å¯¦æˆ° <span class="badge" style="background-color:#c0392b">æ‰‹å¯«é¡Œ</span></h3>
                
                <div class="question-text">
                    <p>è«‹åƒè€ƒä¸‹æ–¹çš„è³‡æ–™è¡¨èˆ‡ç¯„ä¾‹è³‡æ–™ï¼Œæ’°å¯« SQL æŸ¥è©¢ 2024 å¹´åº¦çš„ã€ŒVIP å®¢æˆ¶ã€ã€‚</p>
                    <p><strong>æŸ¥è©¢éœ€æ±‚æ¢ä»¶ï¼š</strong></p>
                    <ol>
                        <li>è¨‚å–®æ—¥æœŸ (OrderDate) å¿…é ˆåœ¨ <strong>2024 å¹´</strong>ã€‚</li>
                        <li>è©²å®¢æˆ¶å¿…é ˆåœ¨ 2024 å¹´è³¼è²·é <strong>2 ç¨®(å«)ä»¥ä¸Š</strong> ä¸åŒçš„ç”¢å“ã€‚</li>
                        <li>ä¾ <strong>æ¶ˆè²»ç¸½é‡‘é¡ (TotalSpent)</strong> ç”±é«˜åˆ°ä½æ’åºï¼Œå– <strong>å‰ 3 å</strong>ã€‚</li>
                    </ol>
                </div>

                <div class="db-tables-container">
                    <div class="table-wrapper">
                        <div class="table-caption">Customers</div>
                        <table class="data-table">
                            <thead><tr><th>ID</th><th>Name</th></tr></thead>
                            <tbody>
                                <tr><td>1</td><td>Alice</td></tr>
                                <tr><td>2</td><td>Bob</td></tr>
                                <tr><td>3</td><td>Charlie</td></tr>
                                <tr><td>4</td><td>David</td></tr>
                                <tr><td>5</td><td>Eve</td></tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="table-wrapper">
                        <div class="table-caption">Products</div>
                        <table class="data-table">
                            <thead><tr><th>ID</th><th>Name</th><th>Price</th></tr></thead>
                            <tbody>
                                <tr><td>101</td><td>é«˜éšç­†é›»</td><td>30,000</td></tr>
                                <tr><td>102</td><td>ç„¡ç·šæ»‘é¼ </td><td>1,000</td></tr>
                                <tr><td>103</td><td>æ©Ÿæ¢°éµç›¤</td><td>3,000</td></tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="table-wrapper">
                        <div class="table-caption">Orders</div>
                        <table class="data-table">
                            <thead><tr><th>ID</th><th>CustID</th><th>Date</th></tr></thead>
                            <tbody>
                                <tr><td>1001</td><td>1 (Alice)</td><td>2024/01</td></tr>
                                <tr><td>1002</td><td>2 (Bob)</td><td>2024/02</td></tr>
                                <tr><td>1004</td><td>4 (David)</td><td>2024/04</td></tr>
                                <tr><td>1005</td><td>5 (Eve)</td><td>2023/12</td></tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="table-wrapper">
                        <div class="table-caption">OrderDetails (éƒ¨åˆ†)</div>
                        <table class="data-table">
                            <thead><tr><th>OrdID</th><th>ProdID</th><th>Qty</th></tr></thead>
                            <tbody>
                                <tr><td>1001</td><td>101 (ç­†é›»)</td><td>2</td></tr>
                                <tr><td>1001</td><td>102 (æ»‘é¼ )</td><td>2</td></tr>
                                <tr><td>1002</td><td>101 (ç­†é›»)</td><td>1</td></tr>
                                <tr><td>1002</td><td>103 (éµç›¤)</td><td>1</td></tr>
                                <tr><td>1004</td><td>101 (ç­†é›»)</td><td>3</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="expected-result-box">
                    <h4>ğŸ“Š é æœŸæ’ˆå–çµæœ (Result)</h4>
                    <table class="data-table" style="background:white;">
                        <thead>
                            <tr>
                                <th>CustomerName</th>
                                <th>TotalSpent (ç¸½é‡‘é¡)</th>
                                <th>AvgOrderValue (å¹³å‡å®¢å–®åƒ¹)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Alice</td>
                                <td>62000.00</td>
                                <td>62000.00</td>
                            </tr>
                            <tr>
                                <td>Bob</td>
                                <td>33000.00</td>
                                <td>33000.00</td>
                            </tr>
                            <tr>
                                <td>Charlie</td>
                                <td>5000.00</td>
                                <td>5000.00</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <span class="editor-hint">ğŸ’¡ æç¤ºï¼šæŒ‰ <strong>Ctrl + Space</strong> å¯è§¸ç™¼ SQL èªæ³•èˆ‡æ¬„ä½è‡ªå‹•æç¤º (Autocomplete)</span>
                <textarea id="sql-answer-editor" name="sql-answer"></textarea>
            </div>

            <button type="button" class="submit-btn" onclick="submitQuiz()" id="submitBtn">æäº¤ç­”æ¡ˆ</button>
        </form>
    </div>

    <div id="loading-message">
        <p>æ­£åœ¨è¨ˆç®—æˆç¸¾ä¸¦ä¸Šå‚³ä¸­ï¼Œè«‹ç¨å€™...</p>
        <p style="font-size: 0.9rem; color: #999;">(è«‹å‹¿é—œé–‰è¦–çª—)</p>
    </div>

    <div id="result-view">
        <div class="success-icon">âœ“</div>
        <h2>æäº¤æˆåŠŸï¼</h2>
        <p id="score-display">æˆç¸¾è¨ˆç®—ä¸­...</p>
        <p style="margin-top:20px; font-size: 0.9rem;">æ‚¨çš„ä½œç­”ç´€éŒ„å·²ä¸Šå‚³è‡³ç³»çµ±ã€‚<br>æ‚¨å¯ä»¥é—œé–‰æ­¤è¦–çª—ã€‚</p>
    </div>

</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-csharp.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-sql.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/sql/sql.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/hint/show-hint.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/hint/sql-hint.min.js"></script>

<script>
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwy7NSKf_yQQtZfvGYd4IpAVMoXKybPRkpaqUUEpePk8by0EC8G3JeQWTa2W02nY0mGJg/exec'; 

    // åˆå§‹åŒ– CodeMirror ç·¨è¼¯å™¨
    var sqlEditor = CodeMirror.fromTextArea(document.getElementById("sql-answer-editor"), {
        mode: "text/x-sql",
        theme: "dracula",
        lineNumbers: true,
        indentWithTabs: true,
        smartIndent: true,
        matchBrackets: true,
        extraKeys: {"Ctrl-Space": "autocomplete"},
        hintOptions: {
            tables: {
                // --- 1. å½è£æˆ Table çš„å¸¸ç”¨é—œéµå­— ---
                "SELECT": [], "FROM": [], "WHERE": [],
                "INNER JOIN": [], "LEFT JOIN": [], "RIGHT JOIN": [],
                "GROUP BY": [], "ORDER BY": [], "HAVING": [],
                "COUNT(*)": [], "SUM()": [], "DISTINCT": [],
                "TOP": [], "AS": [], "ON": [], "AVG": [],

                // --- 2. çœŸå¯¦çš„è³‡æ–™è¡¨çµæ§‹ ---
                "Customers": ["CustomerID", "CustomerName", "Email"],
                "Orders": ["OrderID", "CustomerID", "OrderDate"],
                "OrderDetails": ["OrderDetailID", "OrderID", "Quantity", "UnitPrice"],
                "Products": ["ProductID", "ProductName"]
            }
        }
    });

    sqlEditor.setValue("");

    sqlEditor.on("keyup", function (cm, event) {
        if (!cm.state.completionActive && event.keyCode > 64 && event.keyCode < 91) {
            CodeMirror.commands.autocomplete(cm, null, {completeSingle: false});
        }
    });

    // å®šç¾©é¸æ“‡é¡Œæ­£ç¢ºç­”æ¡ˆ
    const correctAnswers = {
        q1: 'B',  
        q2: ['A', 'B', 'C', 'D'], 
        q3: ['A', 'C'], 
        q4: ['A', 'B', 'C', 'D', 'E'] 
    };

    function submitQuiz() {
        const nameInput = document.getElementById('username');
        const name = nameInput.value.trim();
        
        if (!name) {
            alert('è«‹å¡«å¯«æ‚¨çš„å§“åæ‰èƒ½æäº¤å–”ï¼');
            nameInput.focus();
            return;
        }

        const submitBtn = document.getElementById('submitBtn');
        const loadingMsg = document.getElementById('loading-message');
        const quizContent = document.getElementById('quiz-content'); // æ•´å€‹è¡¨å–®å€åŸŸ
        const resultView = document.getElementById('result-view');   // å®Œæˆç•«é¢
        const scoreDisplay = document.getElementById('score-display');

        // 1. UI åˆ‡æ›ï¼šéš±è—è¡¨å–®ï¼Œé¡¯ç¤º Loading
        quizContent.style.display = 'none'; 
        loadingMsg.style.display = 'block';
        window.scrollTo(0, 0); // æ²å‹•åˆ°æœ€ä¸Šæ–¹

        // è¨ˆç®—åˆ†æ•¸èˆ‡æ”¶é›†è³‡æ–™ (é‚è¼¯ä¸è®Š)
        let score = 0;
        let userAnswersData = {};

        const pointsPerChoice = 20;
        for (let i = 1; i <= 4; i++) {
            const qId = 'q' + i;
            const correctAnswer = correctAnswers[qId];
            const isMultiSelect = Array.isArray(correctAnswer);
            let userValue;

            if (isMultiSelect) {
                const checkedBoxes = document.querySelectorAll(`input[name="${qId}"]:checked`);
                const userValuesArray = Array.from(checkedBoxes).map(cb => cb.value).sort();
                userValue = userValuesArray; 
                if (JSON.stringify(userValuesArray) === JSON.stringify(correctAnswer.sort())) {
                    score += pointsPerChoice;
                }
                if(userValuesArray.length === 0) userValue = "æœªä½œç­”";
            } else {
                const selectedOption = document.querySelector(`input[name="${qId}"]:checked`);
                userValue = selectedOption ? selectedOption.value : "æœªä½œç­”";
                if (userValue === correctAnswer) {
                    score += pointsPerChoice;
                }
            }
            userAnswersData[qId] = Array.isArray(userValue) ? userValue.join(',') : userValue;
        }

        const sqlAnswerRaw = sqlEditor.getValue();
        userAnswersData['q5'] = sqlAnswerRaw;
        
        const sqlAnswerUpper = sqlAnswerRaw.toUpperCase();
        let sqlScore = 0;
        const requiredKeywords = ['SELECT', 'FROM', 'JOIN', 'GROUP BY', 'SUM', 'HAVING', 'DISTINCT'];
        let hitCount = 0;
        requiredKeywords.forEach(keyword => {
            if (sqlAnswerUpper.includes(keyword)) hitCount++;
        });

        if (sqlAnswerRaw.length > 20) {
            if (hitCount >= 6) sqlScore = 20; // æ¨™æº–è®Šé«˜äº†
            else if (hitCount >= 4) sqlScore = 10;
            else if (hitCount >= 2) sqlScore = 5;
            else sqlScore = 0;
        }
        score += sqlScore;
        const finalScore = Math.round(score);

        const payload = {
            name: name,
            score: finalScore,
            answers: userAnswersData
        };
        
        console.log("æäº¤è³‡æ–™:", payload);

        // 2. åŸ·è¡Œä¸Šå‚³
        if (SCRIPT_URL && SCRIPT_URL.startsWith('https')) {
            fetch(SCRIPT_URL, {
                method: 'POST',
                mode: 'no-cors',
                cache: 'no-cache',
                headers: { 'Content-Type': 'application/json' }, // ç¶­æŒ application/json
                body: JSON.stringify(payload)
            }).then(() => {
                // 3. ä¸Šå‚³æˆåŠŸï¼šéš±è— Loadingï¼Œé¡¯ç¤ºå®Œæˆç•«é¢
                loadingMsg.style.display = 'none';
                resultView.style.display = 'block';
               // scoreDisplay.innerHTML = `${name} åŒå­¸ï¼Œæ‚¨çš„é›»è…¦è©•åˆ†æˆç¸¾æ˜¯ï¼š<strong>${finalScore} åˆ†</strong><br>(SQL æ‰‹å¯«é¡Œç”±é›»è…¦é—œéµå­—åˆæ­¥è©•åˆ†)`;
                
            }).catch(err => {
                console.error('Error:', err);
                alert('ç™¼ç”ŸéŒ¯èª¤ï¼šç„¡æ³•é€£æ¥åˆ°ä¼ºæœå™¨ã€‚');
                // ç™¼ç”ŸéŒ¯èª¤æ™‚ï¼ŒæŠŠè¡¨å–®é¡¯ç¤ºå›ä¾†è®“ä½¿ç”¨è€…é‡è©¦
                quizContent.style.display = 'block';
                loadingMsg.style.display = 'none';
                submitBtn.disabled = false;
            });
        } else {
            // æœ¬åœ°æ¸¬è©¦ç”¨
            loadingMsg.style.display = 'none';
            resultView.style.display = 'block';
            scoreDisplay.innerHTML = `[æœ¬åœ°æ¸¬è©¦] ${name} åŒå­¸ï¼Œæ‚¨çš„æˆç¸¾æ˜¯ï¼š<strong>${finalScore} åˆ†</strong>`;
        }
    }
</script>

</body>
</html>


